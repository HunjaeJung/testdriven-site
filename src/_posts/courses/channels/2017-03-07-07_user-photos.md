---
title: User Photos
layout: course
permalink: channels-user-photos
intro: false
part: 1
lesson: 7
share: true
type: course
course: channels
---

Viewing a user's photo is an important piece of functionality in ride-sharing apps. In fact, most of these apps make it mandatory to provide a photo before you can drive or ride. From one perspective, it's a security issue--riders need to confirm that the drivers are who they expect before they enter their vehicles. User photos are also good design and add life to the product.

Our app will allow users to add their photos at sign up.

## Media Files

Media files are a form of user-generated static files and Django handles both in a similar way. We need to provide two new settings, `MEDIA_ROOT` and `MEDIA_URL`.

The `MEDIA_ROOT` is the path to the directory where file uploads will be saved. For the purpose of this tutorial, we can create a `media` folder on the same level as our `example` directory. In a production environment, we'd specify an absolute path to a directory on the server or we'd store files with a service like AWS S3. The `MEDIA_URL` is the prefix to use in our URL path.

Set both the `MEDIA_URL` and the `MEDIA_ROOT` within the settings file:

```python
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
```

One last step is required to get our local environment to serve media files. Update *example_taxi/urls.py* like so:

```python
from django.conf import settings
from django.conf.urls import include, url
from django.conf.urls.static import static
from django.views.generic import TemplateView

from example.apis import SignUpView, LogInView, LogOutView


urlpatterns = [
    url(r'^$', TemplateView.as_view(template_name='index.html')),
    url(r'^api/trip/', include('example.urls', namespace='trip')),
    url(r'^api/sign_up/$', SignUpView.as_view(), name='sign_up'),
    url(r'^api/log_in/$', LogInView.as_view(), name='log_in'),
    url(r'^api/log_out/$', LogOutView.as_view(), name='log_out'),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

Media files can now be retrieved via `http://localhost:8000/media/<file_path>/` on your local machine.

To test, add a new folder called "media" to "django-taxi/example_taxi". Then, add a test file called *test.txt* to that folder and add some random text to the file. Fire up the server and navigate to [http://localhost:8000/media/test.txt](http://localhost:8000/media/test.txt) to view the file.

## Tests

Change the existing `AuthenticationTest.test_user_can_sign_up` test in the following way:

```python
def test_user_can_sign_up(self):
    photo_file = create_photo_file()
    response = self.client.post(reverse('sign_up'), data={
        'username': 'user@example.com',
        'first_name': 'Test',
        'last_name': 'User',
        'password1': PASSWORD,
        'password2': PASSWORD,
        'group': 'rider',
        'photo': photo_file,
    })
    user = get_user_model().objects.last()
    self.assertEqual(HTTP_201_CREATED, response.status_code)
    self.assertEqual(response.data['id'], user.id)
    self.assertEqual(response.data['username'], user.username)
    self.assertEqual(response.data['first_name'], user.first_name)
    self.assertEqual(response.data['last_name'], user.last_name)
    self.assertEqual(response.data['group'], user.group)
    self.assertIsNotNone(user.photo)
```

Add the `create_photo_file` helper function right after the `create_user` helper:

```python
def create_photo_file():
    data = BytesIO()
    Image.new('RGB', (100, 100)).save(data, 'PNG')
    data.seek(0)
    return SimpleUploadedFile('photo.png', data.getvalue())
```

This code leverages the `Pillow` library, `BytesIO` from the standard library, and Django's `SimpleUploadedFile` to create fake image data.

Add the imports:

```python
from io import BytesIO
from PIL import Image
from django.core.files.uploadedfile import SimpleUploadedFile
```

Of course the test will fail since we need to update our user model and its serializer:

```
AttributeError: 'User' object has no attribute 'photo'
```

## File Changes

Modify the user model:

```python
class User(AbstractUser):
    photo = models.ImageField(upload_to='photos', null=True, blank=True)

    @property
    def group(self):
        groups = self.groups.all()
        return groups[0].name if groups else None
```

Now, when users upload their photos, the app will save them in a `photos` subdirectory within our `media` folder.

Don't forget to add `photo` to the `fields` Meta property for both `UserSerializer` and `ReadOnlyUserSerializer` in *example/serializers.py*.

One last thing--create a migration for the new `photo` field on our user table and run the migrations.

```bash
(env)$ python manage.py makemigrations
(env)$ python manage.py migrate
```

Now the tests should pass.

```bash
(env)$ python manage.py test example.tests

Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.............
----------------------------------------------------------------------
Ran 13 tests in 3.982s

OK
Destroying test database for alias 'default'...
```
